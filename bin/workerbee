#!/bin/bash

usage="Usage: workerbee (start|stop|run)"

if [ $# -ne 1 ]; then
	echo $usage
	exit 1
fi

actionCmd=$1

case $actionCmd in
	(start|run|stop)
	;;
	(*)
		echo $usage
		exit 1
	;;
esac

# resolve links - $0 may be a softlink
PRG="${0}"

while [ -h "${PRG}" ]; do
		ls=`ls -ld "${PRG}"`
		link=`expr "$ls" : '.*-> \(.*\)$'`
		if expr "$link" : '/.*' > /dev/null; then
			PRG="$link"
		else
			PRG=`dirname "${PRG}"`/"$link"
		fi
done

BASEDIR=`dirname ${PRG}`
BASEDIR=`cd ${BASEDIR}/..;pwd`
 
source ${BASEDIR}/bin/workerbee-sys.sh

workerbee_start() {

	CLASSPATH=""
	for i in "${BASEDIR}/lib/"*.jar; do
		CLASSPATH="${CLASSPATH}:$i"
	done
	
	if test -z ${JAVA_HOME}
	then
		JAVA_BIN=java
	else
		JAVA_BIN=${JAVA_HOME}/bin/java
	fi
	
	echo ${JAVA_BIN} -cp ${CLASSPATH} com.nexr.workerbee.server.WorkerbeeServer "${@}"
	${JAVA_BIN} -cp ${CLASSPATH} com.nexr.workerbee.server.WorkerbeeServer "${@}" &

	if [ "$?" = "0" ]; then
		echo
		echo "Workerbee $actionCmd succeeded"
		echo
		exit 0
	else
		echo
		echo "ERROR: Workerbee $actionCmd aborted"
		echo
		exit 1
	fi
}

workerbee_stop() {
	echo 
}

case $actionCmd in
	(start|run)
		workerbee_start
		;;
	(stop)
		workerbee_stop
		;;
esac

